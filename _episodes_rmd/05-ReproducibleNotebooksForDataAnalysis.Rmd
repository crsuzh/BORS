---
source: Rmd
title: "Reproducible notebooks for data analysis"
teaching: 60
exercises: 120-150
questions: 
  - "Should I use a graphical user interface to analyse data or a code-based system?"
  - "What is literate programming and what is R Markdown?"
  - "How do I use R  Markdown"
objectives: 
  - "Understand the advantages of code-based data analysis"
  - "Able to create and adapt an R Markdown script"
  - "Adapt a YAML header"
  - "Use code chunks and choose the right chunk options"
  - "Practice R Markdown by answering simple questions"
  - "Bonus: add a table to an R Markdown script"
keypoints:
  - "Code-based analysis is better for reproducibility."
  - "Combining narrative and code-based results is even more profitable."
  - "Code chunks in R Markdown provide an easy solution"
---


```{r, include=FALSE}
source("../bin/chunk-options.R")
knitr_fig_path("05-")
```

# 1. Reproducibility of analysis code


## Graphical user interface (GUI) vs. code

Statistical analysis software packages with graphical user interfaces such as SPSS (often) provide an easy solution to data analysis because

- one can get started with an analysis without much overhead in having to learn to code 
- it is a convenient way of exploring the data is needed 
- figures and the statistical analysis are done at the end of the exploration

**But** it is often not clear anymore how exactly (and with which commands) those results were obtained. 
 
An analysis that is not reproducible can be an issue since 

- it is easy to unintentionally introduce errors and 
- it is hard to get rid of errors 
- if you need to change some step in the middle of the analysis you have to restart from scratch
- you can not provide a workflow that others (or yourself in the future) can follow easily to reproduce the results

To make your analysis reproducible with a GUI program it would be necessary to write down all steps that were done which can be very tedious. Even if some kind of history of the executed commands is saved it might still be necessary to clean this up and keep only the relevant steps.  
 
On the other hand doing a statistical analysis purely with code seems to be a lot of effort since all steps have to be written down explicitly and in case of unfamiliarity with the used programming language some initial investment to get familiar with a new environment and maybe also some basic concepts of programming need to be learned. However, while it seems like a big hurdle modern programming languages designed for statistical computing, such as R, are usually pretty straightforward to learn and use.   
 
Furthermore code based analysis are **more flexible** since usually more combinations, functions and extensions are available. In R, for example, thousands of packages are available. Besides, written analyses are easily **reproducible** as all commands that have been executed are written down and if complemented with comments and descriptions are also easily understandable for humans. 

Such a coded analysis script provides a complete account of what has been calculated, much more complete than any narrative text on used methods could ever be. 

Another point not to underestimate are the many readily available analyses that can be copied and used as a starting point for your own analysis which greatly increases speed and reduces the amount of work. Related to that is the concept of reusing code if for instance you have similar parts in your analysis.  

To summarize:

* **Disadvantages**
  - need to code
  - writing instead of clicking
* **Advantages**
  - Flexible
  - Extensible (packages)
  - Reproducible (easily rerun from scratch)
  - Mixing code and text increases readability 
  - Complete account of analysis
  - start from similar analyses



## R projects

Another very useful concept that enhances R's usefulness via Rstudio are R Projects. They allow to easily implement the structures that we heard about in the "First steps towards more reproducibility" episode (Organisation and software). You start with a directory for each project, have your data, code results etc in subdirectories and the functionality of R projects in Rstudio allows you to communicate easily between these directories.   

The main idea is that all files needed (scripts, data, ...) for an analysis are brought together to make your and your collaborators life easier. If you start a Project it automatically takes care of things like using the correct working directory and lets you quickly jump between different projects by remembering which files you had open and reopening them again.   

Connected to the use of Project is the concept that you use relative file paths (e.g. for loading csv files). So instead of doing something like this: `read.csv("/home/user/Documents/Uni/UnderstandingORS/Topic_5/data/example.csv")` you write `read.csv("data/example.csv")`. This is easier to write, more flexible and less prone to errors because as long as you keep your files in the project together it will work. Imagine for example you want to move your script (and data) to `"/home/user/backup/Uni/UnderstandingORS/Topic_5/data/example.csv"`. 

R Projects hence make collaboration easier, your script will work on a different computer and you do not have to manually adjust the file path. This gets even more important if multiple people work on the same analysis and every one has to change their scripts. 

Another advantage of R Projects is the possibility to quickly switch to another project without mixing up scripts and data between projects. Without using R Projects you probably have to close the files you have open, change the working directory to the new location, open the files you will be using and restart the R session. With R Projects this is all done automatically.


## Quiz on R projects 

> ## File path
> Suppose your current working directory is ~/project and you want to specify the relative path to the file ~/project/data/data.csv . What are possible specifications?
> - data.csv  
> - project/data.csv  
> - project/data/data.csv  
> - data/data.csv  
>
{: .challenge}

> ## Solution
> 
> F data.csv  
> F project/data.csv  
> F project/data/data.csv  
> T data/data.csv  
>
{: .solution}



# 2. Literate programming and R Markdown

R Markdown is a realisation of the **literate programming** concept mixing narrative text with analysis code which is then rendered into formatted text and analysis results (numbers, tables and graphics). The concept of literate programming goes back to Donald Knuth, see e.g. from the [open-science-with-r carpentries course](https://carpentries-incubator.github.io/open-science-with-r/02-Rstudio/index.html):

> _
More generally, the mixture of code, documentation (conclusion, comments) and 
figures in a notebook is part of the so-called “literate programming” paradigm
(Donald Knuth, 1984). Your code and logical steps should be understandable for 
human beings. In particular these four tips are related to this paradigm:
_
>
- _Do not write your program only for R but think also of code readers (that 
  includes you)._
- _Focus on the logic of your workflow. Describe it in plain language (e.g. 
  English) to explain the steps and why you are doing them._
- _Explain the “why” and not the “how”._
- _Create a report from your analysis using a R Markdown notebook to wrap together 
  the data + code + text._


## Parts of an R Markdown (.Rmd) file

### Create a new Rmd
**Execute the following steps on your computer while you read:** 

In Rstudio go to `File` > `New File` > `R Markdown`, enter `Title` and `Author`, select `html` as output, confirm.
A new .Rmd file should open with a short tutorial. 

To render, or `knit`, the file to `html` press `Knit`. The first time you run the script you will have to specify the name under which to save it. Afterwards the script is always saved before rendering. 

An R Markdown file consists of multiple parts which we will discuss now.

### YAML header 

More information about the YAML header can be found in the [R Markdown cheat sheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/rmarkdown.pdf).

Short summary from the [open-science-with-r carpentries course](https://carpentries-incubator.github.io/open-science-with-r/02-Rstudio/index.html):

> _
The header of your R Markdown document will allow you to personalize the related
report from your R Markdown document.
The header follows the YAML syntax (“YAML Ain’t Markup Language”) which usually
follows a key:value syntax.
_

For example, `title: "titlename"`, where `title` is the key and `"titlename"` is the value.

The header itself starts with `---` and stops with `---`. For example:

```
---
title: "titlename"
output: html_output
---
```


### Code chunks

The narrative text is written in Markdown. Code chunks contain R code that is to be executed when rendering the chunk or the entire file, i.e. including the data analysis. A code chunk is delimited from plain text using the following syntax. To start a chunk write (backticks) ` ````{r} `, then place your R code and end the chunk with ` ```` `. The `r` in 
` ```{r} ` indicates that the programming language used in this chunk is R. Other options include `python` or
`bash` although we will not need these here.  
Within RStudio a new code chunk can be included by either clicking on `Insert a new code chunk` in the toolbar or using a keyboard shortcut (`Ctrl+Alt+I` on Windows and `Option+Command+I` on Mac).

Each chunk can be run separately. To run the code in an individual chunk click on the green arrow (`Run Current Chunk`) on the right side of the chunk. 
Alternatively use the keyboard shortcut `Ctrl+Alt+T` (Windows) or `Option+Command+T` (Mac) to run the current chunk (i.e. where your cursor is located). This runs only the code in the specific chunk but does not render the entire file.

For more options see the cheat sheet in R studio: `Help` > `Cheat Sheets` > `R Markdown Cheat Sheet` or the link above.


The behavior of the chunks can be changed by setting chunk options. This is done in the opening of the chunk, e.g. 
` ```{r, echo=FALSE}`, which hides the code of this chunk (while still evaluating it). For more options see the R Markdown cheat sheet or the [R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook/chunk-options.html).

*Note*: inline R code, i.e. code directly within the narrative text, can be run with ``` `r ` ``` , placing the code after `r `. This is for example usefull when you mention a sample size in the text and want it to update directly from the data set you read in.


## Quiz on literate programming and R Markdown

> ## Literate programming
> Which of the following statements about literate programming are true?  
> - Literate programming combines code and text.  
> - Literate programming makes your code run more efficient.  
> - Literate programming makes your analysis easier to understand.  
> - Code should only be shown if necessary.  
> - Plots should not be included.  
>
{: .challenge}

> ## Solution
> 
> T Literate programming combines code and text.  
> F Literate programming makes your code run more efficient.  
> T Literate programming makes your analysis easier to understand.  
> F Code should only be shown if necessary.  
> F Plots should not be included.  
>
{: .solution}


> ## YAML header: author
> How do you specify the author in an R Markdown document?  
> - author: "name"  
> - Author: "name"  
> - Author = "name"  
> - Author: 'name'  
> - author: name  
>
{: .challenge}

> ## Solution
> 
> T author: "name"  
> F Author: "name"  
> F Author = "name"  
> F Author: 'name'  
> T author: name  
>
{: .solution}


> ## YAML header: date
> How do you set the date?  
> - Date: 01/01/2021  
> - Date = 01/01/2021  
> - datum: 01/01/2021  
> - date: 01/01/2021  
>
{: .challenge}

> ## Solution
> 
> F Date: 01/01/2021  
> F Date = 01/01/2021  
> F datum: 01/01/2021  
> T date: 01/01/2021  
>
{: .solution}


> ## Chunk options
> How do you prevent code from evaluation in a chunk?  
> - evaluate=FALSE  
> - eval=FALSE  
> - noeval=TRUE  
> - hinder=TRUE  
> - hind=TRUE  
> - interpret=FALSE  
> - inpr=FALSE  
>
{: .challenge}

> ## Solution
> 
> F evaluate=FALSE  
> T eval=FALSE  
> F noeval=TRUE  
> F hinder=TRUE  
> F hind=TRUE  
> F interpret=FALSE  
> F inpr=FALSE  
>
{: .solution}


> ## Chunk options: figure height
> How do you adjust the figure height?  
> - figure_height=100  
> - figureheight=100  
> - heightfigure=100  
> - fig_height=100  
> - fig.height=100  
> - height.fig=100  
>
{: .challenge}

> ## Solution
> 
> F figure_height=100  
> F figureheight=100  
> F heightfigure=100  
> F fig_height=100  
> T fig.height=100  
> F height.fig=100  
>
{: .solution}


> ## R Markdown Practice
>Modify the template found [here]({{ page.root }}/files/docs/06/RMarkdown_exercise.Rmd) by performing the following steps:
>
>* add author and date to YAML header
>* rename the first chunk to `print_chunk_nr_1`
>* set the chunk options of chunk 2 to not show the code
>* set the chunk options of chunk 3 to not evaluate the code but show it
>* set the chunk options of chunk 4 to not show the warning
>* complete the sentence at the end with appropriate information calculated in chunk 5
>
>After these steps answer the questions:
> 1. The percentage of children who survived the Titanic accident was (Note: round to one decimal digit) 
> 2. The percentage of female survivors was ___ times higher as the percentage of male survivors. (Note: round to two decimal digits) 
{: .challenge}


> ## Solution
> 1. 52.3
> 2. 3.45 
>
{: .solution}

&nbsp;

# Episode challenge

The goal of this challenge is to create a fully reproducible analysis within an R Markdown script which is easy to understand and read. For that, describe what you do and do not forget nice formatting. For example try different Markdown syntax (Headers, ...), figure captions (*Hint*: check the chunk options for this), a meaningful YAML header, etc.


>## Analysis of the palmer penguins data
Create a new R Markdown document and write the code for each of the below questions in a separate paragraph/chunk and describe the result in a complete sentence directly in the R Markdown document. We will use the `penguins` dataset from the package `palmerpenguins`, available as the data set `penguins` after installing the package. To get an overview of the data load the `penguins` dataset and explore the following questions: 
> 
> &nbsp;
> 
>>## Question 1
Find the the source of the `penguins` dataset together with the url to the data repository. *Hint*: run `?penguins`
>{: .checklist}
>
>> ## Solution 1
>> ```{r}
>> library(palmerpenguins)
>>
>> ```
>> Can I put ?penguins in the chunk?
>> 
The source is:
Adélie penguins: Palmer Station Antarctica LTER and K. Gorman. 2020. Structural size measurements and isotopic signatures of foraging among adult male and female Adélie penguins (Pygoscelis adeliae) nesting along the Palmer Archipelago near Palmer Station, 2007-2009 ver 5. Environmental Data Initiative. doi: 10.6073/pasta/98b16d7d563f265cb52372c8ca99e60f
>> 
Gentoo penguins: Palmer Station Antarctica LTER and K. Gorman. 2020. Structural size measurements and isotopic signatures of foraging among adult male and female Gentoo penguin (Pygoscelis papua) nesting along the Palmer Archipelago near Palmer Station, 2007-2009 ver 5. Environmental Data Initiative. doi: 10.6073/pasta/7fca67fb28d56ee2ffa3d9370ebda689
>> 
Chinstrap penguins: Palmer Station Antarctica LTER and K. Gorman. 2020. Structural size measurements and isotopic signatures of foraging among adult male and female Chinstrap penguin (Pygoscelis antarcticus) nesting along the Palmer Archipelago near Palmer Station, 2007-2009 ver 6. Environmental Data Initiative. doi: 10.6073/pasta/c14dfcfada8ea13a17536e73eb6fbe9e
>< 
Originally published in: Gorman KB, Williams TD, Fraser WR (2014) Ecological Sexual Dimorphism and Environmental Variability within a Community of Antarctic Penguins (Genus Pygoscelis). PLoS ONE 9(3): e90081. doi:10.1371/journal.pone.0090081
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 2
Create a Markdown table describing the `penguins` data: for each **numeric** column in the dataset create a row in the table which should consist of the following columns: `Column_Name`, `Mean`, `Variance`  
>>*Hint*: Checkout the function `knitr::kable` and the chunk option `results='asis'`.
>{: .checklist}
>  
>  
>> ## Solution 2
>> ```{r}
>> numericcols <- sapply(colnames(penguins), function(x) is.numeric(penguins[[x]]))
>> df <- data.frame(Column_Name = names(numericcols)[numericcols],
>>                  Mean = signif(apply((na.omit(penguins[numericcols])), 2, mean), 4),
>>                  Variance = signif(apply((na.omit(penguins[numericcols])), 2, var), 4),
>>                  row.names = NULL
>>                  )
>> knitr::kable(df)
>> ```
>>
>{: .solution}
> &nbsp;
>  
>>## Question 3
How many rows does the `penguins` dataset have? 
>{: .checklist}
>
>> ## Solution 3
>> ```{r}
>> result_question_3 <- dim(penguins)[1]
>> ```
>> The data set has `r result_question_3` rows.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 4
What is the first year of records in the data set? 
>{: .checklist}
>
>> ## Solution 4
>> ```{r}
>> result_question_4 <- min(penguins$year)
>> ```
>> The first year of records is `r result_question_4`.
>>
>{: .solution}
> &nbsp;
>  
>>## Question 5
What is the total number of Adelie penguins? 
>{: .checklist}
>
>> ## Solution 5
>> ```{r}
>> result_question_5 <- sum(penguins$species == "Adelie")
>> ```
>> The total number of Adelie penguins is `r result_question_5`
>>
>{: .solution}
> &nbsp;
>  
>>## Question 6
What is the total number of missing values (`NA`)?
>{: .checklist}
>
>> ## Solution 6
>> ```{r}
>> result_question_6 <- sum(is.na(penguins))
>> ```
>> The total number of missing values (NA's) is `r result_question_6`.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 7
What is the total number of rows with **no** missing values?
>{: .checklist}
>
>> ## Solution 7
>> ```{r}
>> result_question_7 <- sum(apply(penguins, 1, function(x) !any(is.na(x))))
>> ```
>> The number of complete rows (rows with no missing values, i.e. NA's) is `rresult_question_7`.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 8
On which islands were the Gentoo penguins found?
>{: .checklist}
>
>> ## Solution 8
>> ```{r}
>> result_question_8 <- unique(penguins$island[penguins$species == "Gentoo"]);
>> ```
>> The name of islands where the Gentoo penguins were found is `r result_question_8`.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 9
What is the proportion of Adelie penguins on Dream island (compared to all penguins on Dream island)?
>{: .checklist}
>
>> ## Solution 9
>> ```{r}
>> result_question_9 <- sum(penguins$species == "Adelie" & 
>>                            penguins$island == "Dream") / 
>>                       sum(penguins$island == "Dream")
>> ```
>> 
>> The proportion of Adelie penguins on Dream island is `r result_question_9`.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 10
What is the 93% quantile of the bill lengths in mm?
>{: .checklist}
>
>> ## Solution 10
>> ```{r}
>> result_question_10 <- quantile(na.omit(penguins$bill_length_mm), 0.93)
>> ```
>> The 93 % quantile of `bill_length_mm` is `r result_question_10`.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 11
What is the absolute mean difference of  bill depth  in mm between female and male penguins?
>{: .checklist}
>
>> ## Solution 11
>> ```{r}
>> result_question_11 <- abs(coef(lm(bill_depth_mm ~ sex, penguins))[2])
>> ```
>> The absolute mean difference of `bill_depth_mm` between female and male is `r result_question_11`.
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 12
What is the 95% confidence interval of the slope of the linear regression with intercept of bill depth regressed on sex? Result will be a vector of two elements, e.g. `c('lower_limit', 'upper_limit')`.
>{: .checklist}
>  
>> ## Solution 12
>> ```{r}
>> result_question_12 <- confint(lm(bill_depth_mm ~ sex, penguins), "sexmale" )
>> ```
>> The 95% confidence interval of the slope of the linear regression between `bill_depth_mm` and `sex` is `r result_question_12`
>> 
>{: .solution}
> &nbsp;
>  
>>## Question 13
What is the proportion of Chinstrap penguins with flipper length in mm smaller than 205 and bill length in mm larger than 45 compared to all penguins with flipper length in mm smaller than 205 and bill length in mm larger than 45?
>{: .checklist}
>  
>> ## Solution 13
>> ```{r}
>> chins <- na.omit(penguins$species[penguins$flipper_length_mm < 205 & 
>>                                     penguins$bill_length_mm > 45])
>> result_question_13 <- sum(chins == "Chinstrap") / length(chins)
>> ```
>> The proportion of Chinstrap penguins with `flipper_length_mm` smaller than 205 and `bill_length_mm` larger than 45 compared to all penguins with `flipper_length_mm` smaller than 205 and `bill_length_mm` larger than 45 is `r result_question_13`.
>>
>{: .solution}
> &nbsp;
>  
>>## Question 14
What is the proportion of Chinstrap penguins with `flipper_length_mm` smaller than 205 and `bill_length_mm` larger than 45 compared to all Chinstrap penguins?
>{: .checklist}
>  
>> ## Solution 14
>> ```{r}
>> result_question_14 <- sum(chins == "Chinstrap") / sum(penguins$species == "Chinstrap")
>> ```
>> The proportion of Chinstrap penguins with `flipper_length_mm` smaller than 205 and `bill_length_mm` larger than 45 compared to all Chinstrap penguins is `r result_question_14`.
>> 
>{: .solution}
{: .challenge}


&nbsp;

# Bonus challenge

```{r, echo = F}
knitr::opts_chunk$set(out.extra = 'class="plot"')
```

>## R Markdown tables
>
>For the following challenge we will use the package `kableExtra` which extends the base capabilities of `knitr::kable` to create tables. From the package [vignette](http://haozhu233.github.io/kableExtra/awesome_table_in_html.html):
>
>
>> _
>>The goal of kableExtra is to help you build common complex tables and manipulate table styles. It imports the pipe `%>%` symbol from magrittr and verbalize all the functions, so basically you can add “layers” to a kable output in a way that is similar with ggplot2 and plotly._
>
>
For users who are not very familiar with the pipe operator `%>%` in R: it is the R version of the fluent interface. The idea is to pass the result along the chain for a more literal coding experience. Basically, when we say A `%>%` B, technically it means sending the results of A to B as B’s first argument.
>
>
>Simple tables can be generated as follows:
>```{r}
>library(kableExtra)
>head(penguins) %>% # the dataset, '%>%' parses the output of this command as the input in the next >command 
>  kbl() %>% # the kableExtra equivalent of knitr::kable, base table
>  kable_classic() # add theme to table
>```
>
>For all options check the documentation or the [vignette](http://haozhu233.github.io/kableExtra/awesome_table_in_html.html).
>
>
> &nbsp;
>
>
>>## Task 1 Create the following table:
>>
>>```{r, echo=FALSE, message=FALSE, warning=FALSE}
>>df_sum <- penguins %>% 
>>  dplyr::select(-sex,-island,-flipper_length_mm,-body_mass_g) %>% 
>>  dplyr::group_by(species, year) %>% 
>>  dplyr::summarise(dplyr::across(.fns = function(x) signif(mean(na.omit(x)), 3))) %>% 
>>  tidyr::pivot_wider(names_from=c(year), values_from = c(bill_length_mm, bill_depth_mm)) 
>>
>>df_sum %>%
>>  kbl(col.names = c("species", rep(c("2007","2008","2009"), 2)))%>%
>>  kable_classic() %>%
>>  add_header_above(c(" " = 1, "bill length [mm]" = 3, "bill depth [mm]" = 3)) %>%
>>  kable_styling(bootstrap_options = c("hover")) %>% 
>>  column_spec (c(1, 4), border_right = T) 
>>
>>```
>>
>>*Hint*: checkout the different styling functions, e.g. `kable_classic`.  
>>*Hint*: For multiple column names use `add_header_above`  
>>*Hint*: Use the following code to get started.  
>{: .checklist}
>
>
>>## Solution
>> ```{r, include=TRUE, echo=TRUE, warning=FALSE, results='hide', message=FALSE}
>> df_sum <- penguins %>% 
>>   dplyr::select(-sex, -island, -flipper_length_mm, -body_mass_g) %>% 
>>   dplyr::group_by(species, year) %>% 
>>   dplyr::summarise(dplyr::across(.fns = function(x) signif(mean(na.omit(x)), 3))) %>% 
>>   tidyr::pivot_wider(names_from = c(year), values_from = c(bill_length_mm, bill_depth_mm)) 
>> 
>> df_sum %>%
>>   kbl(col.names = c("species", rep(c("2007", "2008", "2009"), 2)))%>%
>>   kable_classic() %>%
>>   add_header_above(c(" " = 1, "bill length [mm]" = 3, "bill depth [mm]" = 3)) %>%
>>   kable_styling(bootstrap_options = c("hover")) %>% 
>>   column_spec (c(1, 4), border_right = T) 
>> 
>> ```
>{: .solution}
>
> &nbsp;
>
>>## Task 2 Create the following table wich includes small graphs:
>>
>>```{r, echo=FALSE}
>>df_sum <- penguins %>% 
>>  dplyr::select(-island,-sex,-year,-body_mass_g,-flipper_length_mm) %>% 
>>  dplyr::group_by(species) %>% 
>>  dplyr::summarise(dplyr::across(.cols = !contains("species"),
>>                                 .fns = function(x) 
>>                                   signif(mean(na.omit(x)), 3))) %>% 
>>  dplyr::mutate(bill_length_boxplot="", bill_length_hist="",
>>                bill_depth_boxplot="", bill_depth_hist="")
>>
>>dfsum_list <- split(penguins$bill_length_mm, penguins$species)
>>dfsum_list2 <- split(penguins$bill_depth_mm, penguins$species)
>>df_sum %>%
>>  dplyr::select(species, 
>>                dplyr::starts_with("bill_length"), 
>>                dplyr::starts_with("bill_depth")) %>% 
>>  kbl(col.names = c("species", rep(c("mean","boxplot","histogram"), 2))) %>%
>>  kable_paper() %>%
>>  column_spec(1, border_right = TRUE) %>%
>>  column_spec(3, image = spec_boxplot(dfsum_list)) %>%
>>  column_spec(4, image = spec_hist(dfsum_list), border_right = T) %>%
>>  column_spec(6, image = spec_boxplot(dfsum_list2)) %>% 
>>  column_spec(7, image = spec_hist(dfsum_list2)) %>% 
>>  add_header_above(c(" " = 1, "bill length [mm]" = 3, "bill depth [mm]" = 3),
>>                   border_right = TRUE, border_left = TRUE)
>>
>>```
>>
>>*Hint*: Use `column_spec` for altering specific columns.
>{: .checklist}
>
>
>>## Solution
>> ```{r, include=TRUE, echo=TRUE, warning=FALSE, results='hide', message=FALSE}
>> df_sum <- penguins %>% 
>>   dplyr::select(-island, -sex, -year, -body_mass_g, -flipper_length_mm) %>% 
>>   dplyr::group_by(species) %>% 
>>   dplyr::summarise(dplyr::across(.cols = !contains("species"),
>>                                  .fns = function(x) 
>>                                    signif(mean(na.omit(x)), 3))) %>% 
>>   dplyr::mutate(bill_length_boxplot = "", bill_length_hist = "",
>>                 bill_depth_boxplot = "", bill_depth_hist = "")
>> 
>> dfsum_list <- split(penguins$bill_length_mm, penguins$species)
>> dfsum_list2 <- split(penguins$bill_depth_mm, penguins$species)
>> df_sum %>%
>>   dplyr::select(species, 
>>                 dplyr::starts_with("bill_length"), 
>>                 dplyr::starts_with("bill_depth")) %>% 
>>   kbl(col.names = c("species", rep(c("mean", "boxplot", "histogram"), 2))) %>%
>>   kable_paper() %>%
>>   column_spec(1, border_right = TRUE) %>%
>>   column_spec(3, image = spec_boxplot(dfsum_list)) %>%
>>   column_spec(4, image = spec_hist(dfsum_list), border_right = T) %>%
>>   column_spec(6, image = spec_boxplot(dfsum_list2)) %>% 
>>   column_spec(7, image = spec_hist(dfsum_list2)) %>% 
>>   add_header_above(c(" " = 1, "bill length [mm]" = 3, "bill depth [mm]" = 3),
>>                    border_right = TRUE, border_left = TRUE)
>> ```
>{: .solution}
{: .challenge}

